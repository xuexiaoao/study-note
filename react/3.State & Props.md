## State & Props

组件化是React非常重要的思想，而组件除了生命周期外，还有state和props，它们是组件渲染的数据来源，如果它们发生改变，组件就会重新渲染。

## state

#### 如何定义State

定义一个合适的State，是正确创建组件的第一步。State必须能代表一个组件UI呈现的完整状态集，即组件的任何UI改变，都可以从State的变化中反映出来；同时，State还必须是代表一个组件UI呈现的最小状态集，即State中的所有状态都是用于反映组件UI的变化，没有任何多余的状态，也不需要通过其他状态计算而来的中间状态。

可以通过以下四个条件判断是否应该作为state:

* 这个变量是否是通过Props从父组件中获取？如果是，那么它不是一个状态。
* 这个变量是否在组件的整个生命周期中都保持不变？如果是，那么它不是一个状态。
* 这个变量是否可以通过其他状态（State）或者属性(Props)计算得到？如果是，那么它不是一个状态。
* 这个变量是否在组件的render方法中使用？如果**不是**，那么它不是一个状态。这种情况下，这个变量更适合定义为组件的一个普通属性，例如组件中用到的定时器，就应该直接定义为this.timer，而不是this.state.timer。

**请务必牢记，并不是组件中用到的所有变量都是组件的状态！**当存在多个组件共同依赖一个状态时，一般的做法是**状态提升**，将这个状态放到这几个组件的公共父组件中。

#### 更新state

react不提倡直接修改state，应该使用setState方法修改，否则组件不会渲染。而setState方法是异步的，也就是组件的state不会立马改变，而是把要修改的状态放入一个队列中，React会优化真正的执行时机，并且会出于性能原因，可能会将多次`setState`的状态修改合并成一次状态修改。所以不要依赖当前的State，计算下个State。

如果真的有这样的需求，可以使用另一个接收一个函数作为参数的`setState`，这个函数有两个参数，第一个是当前最新状态（本次组件状态修改后的状态）的前一个状态preState（本次组件状态修改前的状态），第二个参数是当前最新的属性props。

```javascript
this.setState((preState, props) => {
  counter: preState.quantity + 1; 
})
```

当调用setState修改组件状态时，只需要传入发生改变的State，而不是组件完整的State，因为组件State的更新是一个浅合并（Shallow Merge）的过程。

### Props

`props` 的主要作用是让使用该组件的父组件可以传入参数来配置该组件。它是外部传进来的配置参数，组件内部无法控制也无法修改。除非外部组件主动传入新的 `props`，否则组件的 `props` 永远保持不变。









> 参考文章：
>
> [深入理解React 组件状态（State）](https://juejin.im/entry/59522bdb6fb9a06b9a516113)