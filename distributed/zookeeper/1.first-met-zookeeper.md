## 初识Zookeeper

#### 什么是zookeeper

Zookeeper是一种为分布式应用所设计的高可用、高性能、且一致的分布式协调服务，主要是用来解决统一命名服务、状态同步服务、集群管理、分布式应用配置项的管理......

它是由雅虎根据Google的一篇论文参考Chubby实现，后来开源并且捐献给Apache基金会。Zookeeper直译过来是**动物管理员**，是用来管理大象(Hadoop)，蜜蜂(Hive)，小猪(Pig)的管理员:happy:。

#### 为什么需要协调服务

在单机情况下，调用一个服务的结果是一定的，也就是说如果成功，就肯定是成功，如果失败，则肯定是失败的。但是在分布式环境下，由于网络的不可靠性，即使服务返回失败的信息，也可能是执行成功了；为了提升可靠性，我们往往会部署多套服务，但如何在多套服务中保持一致性，在分布式环境下就是一个很棘手的问题。

#### Zookeeper数据模型

Zookeeper的数据模型是树形的，很像文件系统的目录，每个节点称为Znode，但它并没有被设计为常规的数据库或者大数据存储，相反的是，它用来**管理调度数据**，比如分布式应用中的配置文件信息、状态信息、汇集位置等等。 

![](https://images2015.cnblogs.com/blog/126867/201602/126867-20160209232509667-1334974111.png)

* 引用方式：通过路径引用，类似Unix中的文件路径 ，路径必须是绝对的，因此必须由**/**开头， 同时也必须是唯一的。
* Znode数据结构：ZooKeeper命名空间中的Znode，兼具文件和目录两种特点。既像文件一样维护着数据、元信息、ACL、时间戳等数据结构，又像目录一样可以作为路径标识的一部分。
  * stat ：此为状态信息, 描述该Znode的版本, 权限等信息 
  * data：与该Znode关联的数据 
  * children：该Znode下的子节点 
* 节点类型
  * 临时节点：该节点的生命周期依赖于创建它们的会话。一旦会话(Session)结束，临时节点将被自动删除 
  * 永久节点：该节点的生命周期不依赖于会话，并且只有在客户端显示执行删除操作的时候，他们才能被删除 。
* Watcher机制：客户端可以在节点上设置watch，我们称之为**监视器**。当节点状态发生改变时(Znode的增、删、改)将会触发watch所对应的操作。当watch被触发时，ZooKeeper将会向客户端发送且仅发送一条通知 ，该机制是 zookeeper 实现分布式协调服务的重要特性 。









#### 参考文档

* [ZooKeeper学习第一期---Zookeeper简单介绍](https://www.cnblogs.com/sunddenly/p/4033574.html)
* [漫画：什么是ZooKeeper](https://juejin.im/post/5b037d5c518825426e024473)
* [一直对zookeeper的应用和原理比较迷糊，今天看一篇文章，讲得很通透](https://juejin.im/entry/5aea87946fb9a07aa83e9039)
* [docker-zookeeper集群搭建(伪集群)](https://www.jianshu.com/p/9a2963c2998a)